"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),i=require("react-uid"),t=require("antd"),n=e.createContext(null);function o(){return(o=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}var r=function(i){return e.createElement("div",Object.assign({className:"ant-design-draggable-modal-resize-handle"},i),e.createElement("div",{className:"ant-design-draggable-modal-resize-handle-inner"}))},a={margin:0,paddingBottom:0,pointerEvents:"auto"};function d(i){var n=i.id,d=i.modalState,u=i.dispatch,s=i.open,l=i.children,h=i.title,c=i.initialWidth,w=i.initialHeight,m=function(e,i){if(null==e)return{};var t,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)i.indexOf(t=r[n])>=0||(o[t]=e[t]);return o}(i,["id","modalState","dispatch","open","children","title","initialWidth","initialHeight"]);e.useEffect((function(){return u({type:"mount",id:n,intialState:{initialWidth:c,initialHeight:w}}),function(){return u({type:"unmount",id:n})}}),[u,n,c,w]);var f,g,v=(g=e.useRef(f=s),e.useEffect((function(){g.current=f}),[f]),g.current);e.useEffect((function(){s!==v&&u(s?{type:"show",id:n}:{type:"hide",id:n})}),[s,v,n,u]);var x=d.zIndex,p=d.x,z=d.y,y=d.width,E=d.height,S=e.useMemo((function(){return o({},a,{top:z,left:p,height:E})}),[z,p,E]),I=e.useCallback((function(){return u({type:"focus",id:n})}),[n,u]),b=e.useCallback((function(e){return u(o({type:"drag",id:n},e))}),[u,n]),D=e.useCallback((function(e){return u(o({type:"resize",id:n},e))}),[u,n]),X=function(i,t,n){var o=e.useState(!1),r=o[0],a=o[1],d=e.useState({initX:0,initY:0,mouseDownX:0,mouseDownY:0}),u=d[0],s=d[1],l=e.useCallback((function(e){e.preventDefault(),s({initX:i,initY:t,mouseDownX:e.clientX,mouseDownY:e.clientY}),a(!0)}),[i,t,a,s]);return e.useEffect((function(){var e=function(e){r&&n({x:u.initX+(e.clientX-u.mouseDownX),y:u.initY+(e.clientY-u.mouseDownY)})};return window.addEventListener("mousemove",e,{passive:!0}),function(){return window.removeEventListener("mousemove",e)}}),[u,r,n]),e.useEffect((function(){var e=function(){a(!1)};return window.addEventListener("mouseup",e),function(){return window.removeEventListener("mouseup",e)}}),[a]),l}(p,z,b),Y=function(i,t,n,o,r){var a=e.useState(!1),d=a[0],u=a[1],s=e.useState({initX:0,initY:0,initWidth:0,initHeight:0,mouseDownX:0,mouseDownY:0}),l=s[0],h=s[1],c=e.useCallback((function(e){e.preventDefault(),h({initX:i,initY:t,initWidth:n,initHeight:o,mouseDownX:e.clientX,mouseDownY:e.clientY}),u(!0)}),[n,o,u,h,i,t]);return e.useEffect((function(){var e=function(e){if(d)return r({x:l.initX,y:l.initY,width:l.initWidth+(e.clientX-l.mouseDownX),height:l.initHeight+(e.clientY-l.mouseDownY)})};return window.addEventListener("mousemove",e,{passive:!0}),function(){return window.removeEventListener("mousemove",e)}}),[l,d,r]),e.useEffect((function(){var e=function(){u(!1)};return window.addEventListener("mouseup",e),function(){return window.removeEventListener("mouseup",e)}}),[u]),c}(p,z,y,E,D),Z=e.useMemo((function(){return e.createElement("div",{className:"ant-design-draggable-modal-title",onMouseDown:X,onClick:I},h)}),[X,I,h]);return e.createElement(t.Modal,Object.assign({wrapClassName:"ant-design-draggable-modal",style:S,width:y,destroyOnClose:!0,mask:!1,maskClosable:!1,zIndex:x,title:Z,open:s},m),l,e.createElement(r,{onMouseDown:Y}))}var u=e.memo(d),s=function(){return{width:window.innerWidth||0,height:window.innerHeight||0}},l=function(e,i,t){return Math.max(e,Math.min(i,t))},h={maxZIndex:0,windowSize:s(),modals:{}},c={x:0,y:0,width:800,height:800,zIndex:0,open:!1},w=function(e){var i=e.initialWidth,t=e.initialHeight;return o({},c,{width:void 0===i?c.width:i,height:void 0===t?c.height:t})},m=function(e){return e.state.modals[e.id]||w({initialWidth:e.initialWidth,initialHeight:e.initialHeight})},f=function(e,i){return m({state:e,id:i}).zIndex===e.maxZIndex?e.maxZIndex:e.maxZIndex+1},g=function(e,i,t,n,o,r){var a=i-r;return{x:l(0,e-o,t),y:l(0,a,n)}},v=function(e,i,t,n,o,r){var a=i-n;return{width:l(200,e-t,o),height:l(200,a,r)}},x=function(e,i){var t,n,r,a,d,u;switch(i.type){case"resize":var s=v(e.windowSize.width,e.windowSize.height,i.x,i.y,i.width,i.height);return o({},e,{maxZIndex:f(e,i.id),modals:o({},e.modals,(t={},t[i.id]=o({},e.modals[i.id],s,{zIndex:f(e,i.id)}),t))});case"drag":return o({},e,{maxZIndex:f(e,i.id),modals:o({},e.modals,(n={},n[i.id]=o({},e.modals[i.id],g(e.windowSize.width,e.windowSize.height,i.x,i.y,e.modals[i.id].width,e.modals[i.id].height),{zIndex:f(e,i.id)}),n))});case"show":var l,h=e.modals[i.id],c=g(e.windowSize.width,e.windowSize.height,e.windowSize.width/2-h.width/2,e.windowSize.height/2-h.height/2,h.width,h.height),m=v(e.windowSize.width,e.windowSize.height,c.x,c.y,h.width,h.height);return o({},e,{maxZIndex:e.maxZIndex+1,modals:o({},e.modals,(l={},l[i.id]=o({},h,c,m,{zIndex:e.maxZIndex+1,open:!0}),l))});case"focus":return o({},e,{maxZIndex:e.maxZIndex+1,modals:o({},e.modals,(r={},r[i.id]=o({},e.modals[i.id],{zIndex:e.maxZIndex+1}),r))});case"hide":var x;return o({},e,{modals:o({},e.modals,(x={},x[i.id]=o({},e.modals[i.id],{open:!1}),x))});case"mount":var p=w(i.intialState);return o({},e,{maxZIndex:e.maxZIndex+1,modals:o({},e.modals,(a={},a[i.id]=o({},p,{x:e.windowSize.width/2-p.width/2,y:e.windowSize.height/2-p.height/2,zIndex:e.maxZIndex+1}),a))});case"unmount":var z=o({},e.modals);return delete z[i.id],o({},e,{modals:z});case"windowResize":return o({},e,{windowSize:i.size,modals:(d=e.modals,u=function(i){if(!i.open)return i;var t=g(e.windowSize.width,e.windowSize.height,i.x,i.y,i.width,i.height);return o({},i,t,v(e.windowSize.width,e.windowSize.height,t.x,t.y,i.width,i.height))},Object.assign.apply(Object,[{}].concat(Object.keys(d).map((function(e){var i;return(i={})[e]=u(d[e]),i})))))});default:throw new Error}};exports.DraggableModal=function(t){var o=i.useUID(),r=e.useContext(n);if(!r)throw new Error("No Provider");var a=r.dispatch,d=m({state:r.state,id:o,initialHeight:t.initialHeight,initialWidth:t.initialWidth});return e.createElement(u,Object.assign({id:o,dispatch:a,modalState:d},t))},exports.DraggableModalContext=n,exports.DraggableModalProvider=function(i){var t=i.children,o=e.useReducer(x,h),r=o[0],a=o[1];return e.useEffect((function(){if("object"==typeof window){var e=function(){return a({type:"windowResize",size:s()})};return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}}),[a]),e.createElement(n.Provider,{value:{state:r,dispatch:a}},t)};
//# sourceMappingURL=ant-design-draggable-modal.cjs.production.min.js.map
